<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Insertion Sort</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
        },
        svg: {
          fontCache: 'global'
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>

    <style>
        :root {
            --primary-color: #6200EE;
            --primary-variant: #3700B3;
            --secondary-color: #03DAC6;
            --background-color: #f5f5f5;
            --surface-color: #ffffff;
            --on-primary: #ffffff;
            --on-surface: #000000;
            --text-muted: #555555; /* Darkened for better contrast */
            --book-color: #E0E0E0;
            --book-border: #BDBDBD;
            --sorted-color: #C8E6C9; /* A light green */
            --highlight-color: #f8e71c; /* A yellow highlight */
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            margin: 0;
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            color: var(--on-surface);
            overflow-x: hidden;
        }
        
        mjx-container {
            font-size: 1em !important;
        }

        .app-container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .card {
            background-color: var(--surface-color);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 500;
            margin: 0 0 0.5rem 0;
            color: var(--primary-variant);
        }

        p {
            margin: 0 0 0.5rem 0;
            line-height: 1.6;
            color: var(--text-muted);
            font-size: 1.05rem; /* Increased size */
        }

        .visualization-container {
            position: relative;
            padding: 4rem 1rem 4rem 1rem; /* Increased padding */
            background: var(--surface-color);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            min-height: 260px;
        }

        .labels {
            position: absolute;
            top: 1.5rem; /* More space */
            left: 0;
            width: 100%;
            display: flex;
            padding: 0 1rem;
            box-sizing: border-box;
            align-items: center;
        }

        .labels span {
            font-size: 0.95rem; /* Increased size */
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 500;
        }
        
        #unsorted-label {
           margin-left: 10px;
        }

        #bookshelf-wrapper {
            position: relative;
            overflow-x: auto; /* For responsiveness */
            padding-bottom: 10px;
        }
        #bookshelf-wrapper::-webkit-scrollbar { height: 8px; }
        #bookshelf-wrapper::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        #bookshelf-wrapper::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        #bookshelf-wrapper::-webkit-scrollbar-thumb:hover { background: #aaa; }

        #bookshelf {
            display: flex;
            align-items: flex-end;
            height: 180px;
            position: relative;
            padding: 0 5px;
        }

        #shelf-base {
            height: 15px;
            background-color: #333;
            border-radius: 3px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            position: absolute;
            bottom: 1.5rem;
            left: 1rem;
            right: 1rem;
        }
        
        .book {
            height: 160px;
            width: 35px;
            background-color: var(--book-color);
            border: 1px solid var(--book-border);
            border-radius: 3px 3px 0 0;
            margin: 0 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }

        .book-title {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            white-space: nowrap;
            font-size: 0.8rem;
            color: #333;
            transform: rotate(180deg);
        }

        .book.sorted {
            background-color: var(--sorted-color);
        }
        
        .book.considering {
            animation: lift-up 0.5s ease-out forwards;
        }

        .book.placed {
             animation: drop-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
             box-shadow: 0 0 15px 5px var(--highlight-color);
        }

        @keyframes lift-up {
            0% { transform: translateY(0); box-shadow: none; border: 1px solid var(--book-border); }
            50% { transform: translateY(-50px); box-shadow: 0 10px 15px rgba(0,0,0,0.2); border: 2px solid var(--primary-color); }
            100% { transform: translateY(-50px); box-shadow: 0 10px 15px rgba(0,0,0,0.2); border: 2px solid var(--primary-color); }
        }
        
        @keyframes drop-in {
            from { transform: translateY(-50px); opacity: 0.8; }
            to { transform: translateY(0); opacity: 1; }
        }

        #bookshelf.fully-sorted .book {
            animation: final-bounce 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            animation-delay: calc(var(--i) * 50ms);
        }

        @keyframes final-bounce {
            0% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0); }
        }

        #divider {
            position: absolute;
            top: -20px;
            bottom: 0;
            width: 2px;
            background-image: linear-gradient(to bottom, #999 50%, transparent 50%);
            background-size: 100% 10px;
            transition: left 0.5s ease-in-out;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            font-size: 1rem;
            align-items: center;
        }

        button {
            background-color: var(--primary-color);
            color: var(--on-primary);
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 0.95rem;
            font-weight: 500;
            border-radius: 4px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            transition: all 0.2s cubic-bezier(.25,.8,.25,1);
        }

        button:hover:not(:disabled) {
            box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
            background-color: var(--primary-variant);
        }

        button:disabled {
            background-color: #BDBDBD;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        #reset-btn {
            background-color: transparent;
            color: var(--primary-color);
            box-shadow: none;
            border: 1px solid #ddd;
        }
        
        #reset-btn:hover:not(:disabled) {
            background-color: rgba(98, 0, 238, 0.08);
        }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="card">
            <h1>Insertion Sort Bookshelf</h1>
            <p id="instructions">The algorithm builds a sorted section on the left, taking one book at a time and inserting it into the correct position.</p>
        </div>

        <div class="visualization-container">
            <div class="labels">
                <span id="sorted-label">Sorted</span>
                <div id="divider"></div>
                <span id="unsorted-label">Unsorted</span>
            </div>
            <div id="bookshelf-wrapper">
                <div id="bookshelf"></div>
            </div>
            <div id="shelf-base"></div>
        </div>

        <div class="card controls">
            <div class="stats">
                <span>Step: <span id="step-count">0 / 7</span></span>
                <span>Comparisons: <span id="comparisons-count">$C=0$</span></span>
            </div>
            <div>
              <button id="next-btn">Next Step</button>
              <button id="reset-btn">Reset</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const initialBooks = [
                { id: 1, title: 'Calculus' },
                { id: 2, title: 'Linear Algebra' },
                { id: 3, title: 'Algorithms' },
                { id: 4, title: 'Discrete Mathematics' },
                { id: 5, title: 'Database Systems' },
                { id: 6, title: 'Python Programming' },
                { id: 7, title: 'Scheme Programming' },
                { id: 8, title: 'Statistics' }
            ];

            let books = [];
            let state = {};
            
            const bookshelf = document.getElementById('bookshelf');
            const instructions = document.getElementById('instructions');
            const nextBtn = document.getElementById('next-btn');
            const resetBtn = document.getElementById('reset-btn');
            const comparisonsCount = document.getElementById('comparisons-count');
            const stepCount = document.getElementById('step-count');
            const divider = document.getElementById('divider');
            const unsortedLabel = document.getElementById('unsorted-label');

            const deepCopy = (obj) => JSON.parse(JSON.stringify(obj));

            function initialize() {
                books = deepCopy(initialBooks);
                state = {
                    sortedUpto: 0, // Index of the last item in the sorted partition
                    isDone: false,
                    isAnimating: false,
                    comparisons: 0,
                    phase: 'start', // 'start', 'considering', 'placed', 'done'
                    consideringBook: null,
                };
                
                bookshelf.classList.remove('fully-sorted');
                instructions.textContent = 'The first book is considered a sorted section of one. Click "Next Step" to sort the rest.';
                nextBtn.disabled = false;
                nextBtn.textContent = 'Next Step';
                
                render();
            }
            
            function render() {
                bookshelf.innerHTML = '';
                
                books.forEach((book, index) => {
                    const bookEl = document.createElement('div');
                    bookEl.className = 'book';
                    bookEl.dataset.id = book.id;
                    bookEl.style.setProperty('--i', index);

                    const titleEl = document.createElement('div');
                    titleEl.className = 'book-title';
                    titleEl.textContent = book.title;
                    bookEl.appendChild(titleEl);

                    if (index <= state.sortedUpto) {
                        bookEl.classList.add('sorted');
                    }
                    
                    if (state.consideringBook && state.consideringBook.id === book.id) {
                         if (state.phase === 'considering') {
                             bookEl.classList.add('considering');
                         } else if (state.phase === 'placed') {
                             bookEl.classList.add('placed');
                             setTimeout(() => bookEl.classList.remove('placed'), 1000);
                         }
                    }
                    bookshelf.appendChild(bookEl);
                });

                if (state.isDone) {
                    bookshelf.classList.add('fully-sorted');
                }

                updateDivider();
                updateStats();
                updateProgress();
            }
            
            function updateDivider() {
                const bookWidth = 39; // width (35) + margin (2*2)
                const offset = (state.sortedUpto + 1) * bookWidth;
                const totalWidth = books.length * bookWidth;
                
                if (state.isDone) {
                     divider.style.left = `${totalWidth + 5}px`;
                     unsortedLabel.style.transform = `translateX(${totalWidth + 10}px)`;
                } else {
                    divider.style.left = `${offset}px`;
                    unsortedLabel.style.transform = `translateX(${offset + 5}px)`;
                }
            }
            
            function updateStats() {
                comparisonsCount.innerHTML = `$C=${state.comparisons}$`;
                if(window.MathJax && window.MathJax.typeset) {
                    MathJax.typeset([comparisonsCount]);
                }
            }

            function updateProgress() {
                const totalSteps = books.length > 0 ? books.length - 1 : 0;
                const currentStep = state.isDone ? totalSteps : state.sortedUpto;
                stepCount.textContent = `${currentStep} / ${totalSteps}`;
            }

            function handleNextStep() {
                if (state.isDone || state.isAnimating) return;

                const consideringIndex = state.sortedUpto + 1;
                
                if (consideringIndex >= books.length) {
                    if (!state.isDone) {
                        state.isDone = true;
                        state.phase = 'done';
                        instructions.textContent = 'Congratulations! The bookshelf is now fully sorted.';
                        nextBtn.textContent = 'Done';
                        nextBtn.disabled = true;
                        render();
                    }
                    return;
                }

                if (state.phase === 'placed' || state.phase === 'start') {
                    state.phase = 'considering';
                    state.consideringBook = books[consideringIndex];
                    instructions.textContent = `Next up: "${state.consideringBook.title}". Click again to find its correct place.`;
                    render();
                } else if (state.phase === 'considering') {
                    state.isAnimating = true;
                    nextBtn.disabled = true;

                    const keyBook = books[consideringIndex];
                    let j = state.sortedUpto;
                    let comparisonsInStep = 0;
                    
                    while (j >= 0 && books[j].title.localeCompare(keyBook.title) > 0) {
                        state.comparisons++;
                        comparisonsInStep++;
                        j--;
                    }
                    if (j >= 0) {
                        state.comparisons++;
                        comparisonsInStep++;
                    }

                    const insertIndex = j + 1;
                    
                    setTimeout(() => {
                        const itemToMove = books.splice(consideringIndex, 1)[0];
                        books.splice(insertIndex, 0, itemToMove);
                        
                        state.phase = 'placed';
                        state.sortedUpto++;
                        instructions.textContent = `"${keyBook.title}" was inserted after ${comparisonsInStep} comparison(s).`;
                        
                        render();
                        state.isAnimating = false;
                        nextBtn.disabled = false;
                        
                        if (state.sortedUpto === books.length - 1) {
                           handleNextStep();
                        }
                    }, 600);
                }
            }

            nextBtn.addEventListener('click', handleNextStep);
            resetBtn.addEventListener('click', initialize);

            initialize();
        });
    </script>
</body>
</html>